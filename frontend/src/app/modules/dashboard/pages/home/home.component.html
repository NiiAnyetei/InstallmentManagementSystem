<div>
    <!-- Header -->
    <div class="mb-4 flex justify-between">
        <div class="inline-block">
            <h3 class="font-semibold text-foreground">Dashboard</h3>
            <!-- <div class="space-x-1 text-xs font-medium text-muted-foreground">
                <a href="" class="hover:text-primary">Dashboards</a>
                <span> - NFTs</span>
            </div> -->
        </div>
        <div class="inline-block space-x-4">
            <!-- <button
                class="flex-none rounded-md bg-muted px-4 py-2.5 text-xs font-semibold text-muted-foreground hover:text-foreground">
                Manage Bids
            </button> -->
            <!-- <button class="flex-none rounded-md bg-primary px-4 py-2.5 text-xs font-semibold text-primary-foreground">
                Refresh
            </button> -->
        </div>
    </div>

    <!-- end Header -->

    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4">
        @if (metricsLoadState == 'Loading') {
            <!-- Loading Cards -->
             @for (item of [1,2,3,4]; track $index) {
                 <article class="flex items-center gap-4 rounded-lg border border-border bg-background p-6 animate-pulse">
                     <div class="rounded-full bg-slate-200 dark:bg-slate-700 size-14"></div>
         
                     <div class="group relative">
                        <div class="h-6 w-12 bg-slate-200 dark:bg-slate-700 rounded"></div>
         
                        <div class="mt-1 h-2 w-28 bg-slate-200 dark:bg-slate-700 rounded"></div>
                     </div>
                 </article>
             }
        }

        @if (metricsLoadState == 'Loaded') {
    
            <!-- Customers Card -->
            <article class="flex items-center gap-4 rounded-lg border border-border bg-background p-6">
                <span class="rounded-full bg-blue-100 p-3 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400">
                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="size-8"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </span>
    
                <div class="group relative">
                    <p class="text-2xl font-medium text-foreground border-b border-dashed w-fit">{{metrics()[0].value | thousandSuff}}</p>
                    <span class="group-hover:opacity-100 transition-opacity bg-card px-1 text-sm text-foreground rounded-md absolute left-1/2 -translate-x-1/2 translate-y-full opacity-0 m-4 mx-auto">{{metrics()[0].value | number}}</span>
    
                    <p class="text-sm text-muted-foreground">{{metrics()[0].name}}</p>
                </div>
            </article>
            
            <!-- Installments Card -->
            <article class="flex items-center gap-4 rounded-lg border border-border bg-background p-6">
                <span class="rounded-full bg-blue-100 p-3 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400">
                    <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="size-8"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                </span>
    
                <div class="group relative">
                    <p class="text-2xl font-medium text-foreground border-b border-dashed w-fit">{{metrics()[1].value | thousandSuff}}</p>
                    <span class="group-hover:opacity-100 transition-opacity bg-card px-1 text-sm text-foreground rounded-md absolute left-1/2 -translate-x-1/2 translate-y-full opacity-0 m-4 mx-auto">{{metrics()[1].value | number}}</span>
    
                    <p class="text-sm text-muted-foreground">{{metrics()[1].name}}</p>
                </div>
            </article>
            
            <!-- Payments Card -->
            <article class="flex items-center gap-4 rounded-lg border border-border bg-background p-6">
                <span class="rounded-full bg-blue-100 p-3 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400">
                    <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="size-8"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                    >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"
                    />
                    </svg>
                </span>
    
                <div class="group relative">
                    <p class="text-2xl font-medium text-foreground border-b border-dashed w-fit">GHS{{metrics()[2].value | thousandSuff}}</p>
                    <span class="group-hover:opacity-100 transition-opacity bg-card px-1 text-sm text-foreground rounded-md absolute left-1/2 -translate-x-1/2 translate-y-full opacity-0 m-4 mx-auto">GHS{{metrics()[2].value | number: '.2'}}</span>
    
                    <p class="text-sm text-muted-foreground">{{metrics()[2].name}}</p>
                </div>
            </article>
            
            <!-- Bills Card -->
            <article class="flex items-center gap-4 rounded-lg border border-border bg-background p-6">
                <span class="rounded-full bg-blue-100 p-3 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400">
                    <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="size-8"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                    >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"
                    />
                    </svg>
                </span>
    
                <div class="group relative">
                    <p class="text-2xl font-medium text-foreground border-b border-dashed w-fit">GHS{{metrics()[3].value | thousandSuff}}</p>
                    <span class="group-hover:opacity-100 transition-opacity bg-card px-1 text-sm text-foreground rounded-md absolute left-1/2 -translate-x-1/2 translate-y-full opacity-0 m-4 mx-auto">GHS{{metrics()[3].value | number: '.2'}}</span>
    
                    <p class="text-sm text-muted-foreground">{{metrics()[3].name}}</p>
                </div>
            </article>
    
            <!-- End Stats Card -->
             
        }

        @if (metricsLoadState == 'Error') {
            <div class="col-span-1 md:col-span-2 xl:col-span-4 flex flex-col mx-auto items-center gap-2">
                <span class="text-center text-sm text-foreground">Something went wrong</span>
                <div class="inline-block">
                    <button (click)="getDashboardMetrics()" class="flex-none rounded-md bg-primary px-4 py-2.5 text-xs font-semibold text-primary-foreground">
                        Try again
                    </button>
                </div>
            </div>
        }

    </div>

    <!-- Customers Table -->
    <div class="mt-4 md:col-span-4 flex min-w-full flex-col rounded-xl border border-muted/20 bg-background p-2">
        <div class="flex flex-wrap items-center justify-between gap-2 py-3 px-5">
            <h3 class="text-sm font-medium text-muted-foreground">Showing {{getDisplayRange().end}} of {{p.getTotalItems()}} customers</h3>
            <div class="flex flex-wrap gap-2">
                <a [routerLink]="['/customers']" class="flex-none rounded-md bg-card px-4 py-2.5 text-xs font-semibold text-muted-foreground hover:bg-muted hover:text-foreground"> View all </a>
            </div>
        </div>
    
        <div class="overflow-x-auto scrollbar-thumb-rounded scrollbar-track-rounded scrollbar-thin scrollbar-track-transparent scrollbar-thumb-card">
            <table
                class="table w-full table-auto border-collapse border-0 text-left align-middle leading-5 text-muted-foreground">
                <thead class="border border-muted/20 text-xs text-muted-foreground">
                    <ng-container>
                        <th scope="col">Customer</th>
                        <th scope="col">Phone Number</th>
                        <th scope="col">ID Number</th>
                    </ng-container>
                </thead>
                <tbody>
                    @if (loadState == 'Loading') {
                        <tr>
                            <td class="py-4 text-center text-sm" colspan="7">Loading ...</td>
                        </tr>
                    } 
                     
                    @if (loadState == 'Loaded') {
                        @for (customer of customers() | paginate: config; track $index) {
                        <tr class="hover:bg-card/50 transition-all">
                            <ng-container>
                                <td>
                                    <div class="flex items-center gap-2.5">
                                        <div class="flex items-center h-9 w-9 rounded-full bg-blue-100 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400"><span class="mx-auto">{{customer.fullName | initials}}</span></div>
                                        <div class="flex flex-col">
                                            <a class="text-sm font-semibold text-foreground hover:text-primary"> {{
                                                customer.fullName }} </a>
                                            <a class="text-xs font-medium text-muted-foreground/70 hover:text-primary">
                                                {{ customer.email }}
                                            </a>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ customer.phoneNumber }}</td>
                                <td>
                                    {{ customer.identificationNumber }}
                                </td>
                            </ng-container>
                        </tr>
                        } @empty {
                        <tr>
                            <td class="py-4 text-center text-sm" colspan="7">No data</td>
                        </tr>
                        }
                    }
    
                    @if (loadState == 'Error') {
                        <tr>
                            <td class="py-4 text-center text-sm" colspan="7">Something went wrong. Please try again</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    
        <!-- Footer -->
        <div class="flex flex-wrap items-center justify-between gap-2 py-3 px-5 text-xs text-muted-foreground">
            <div class="order-1 flex items-center gap-4 md:order-2">
                <span>{{ getDisplayRange().start }}-{{ getDisplayRange().end }} of {{p.getTotalItems()}}</span>
    
                <pagination-template #p="paginationApi" [id]="config.id!" (pageChange)="onPageChange($event)" (pageBoundsCorrection)="onPageBoundsCorrection($event)"></pagination-template>
            </div>
        </div>
    </div>
</div>